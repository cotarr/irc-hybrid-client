<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

		<title>API Examples</title>
    <link rel="stylesheet" href="css/styles.css">
	</head>
	<body>
    <div class="header-div">
      Documentation for
      <a href="https://github.com/cotarr/irc-hybrid-client">irc-hybrid-client</a>
    </div>
    <div class="menu-div-fixed">
      <div class="menu-div">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="installation.html">Installation</a></li>
          <li><a href="login-config.html">Login Config</a></li>
          <li><a href="server-config.html">IRC Config</a></li>
          <li><a href="text-commands.html">Text Commands</a></li>
          <li><a href="faq.html">FAQ</a></li>
          <li><a href="coding.html">Coding Notes</a></li>
          <li><a class="active" href="api.html">API Examples</a></li>
          <li><a href="license.html">License</a></li>
        </ul>
      </div>
    </div> <!-- /menu-div-fixed -->

    <div class="outer-div">
      <div class="text-div">
        <div class="desc-title">
          API Examples
        </div>

        <img src="images/network.png" height="267" width="882" alt="Network Diagram">

        <p>
          Generally, the browser communication is split. Messages from the web server to browser
          are passed over the websocket as RFC 2812 IRC server messages.
          In the reverse direction, no messages are passed from the browser to web server over the websocket.
          All messages from the browser to the web server are passed over a web API using POST and GET requests.
          More specifically, IRC server messages (such as PRIVMSG) are passed over
          the /irc/message route as UTF-8 strings using a POST web API request.
          Information related to the state of the IRC connection and channel membership
          are retrieved as needed by issuing a GET request to the web API.
        </p>

        <p>
          The web browser IRC client operates on IRC messages received from the backend
          NodeJs web server. These are RFC 2812 standard IRC messages.
          Some non-standard (outside RFC 2812) messages are passed over the websocket
          for control purposes as described below.
        </p>

        <p>
          In most cases, the API requests return a web response showing
          the asynchronous request was either accepted or caused an error.
          The API response body contains an error boolean flag within a JSON object.
        </p>

        <p>
          General state errors, such as &quot;IRC Server not connected&quot; are returned
          within API response body with status 200 and description of the error as a JSON object.
        </p>

        <p>
          Data validation or parsing errors are returned as status 400 Bad Request.
        </p>

        <p>
          Network connection errors occurring with the IRC server connection between NodeJs backend and IRC server
          are returned in the websocket stream prefixed with the string value &quot;webError: &quot;.
        </p>

        <p>
          Errors occurring over IRC network are returned within the websocket stream
          as standard IRC RFC 2812 messages containing 3 digit numeric code and
          descriptive string.
        </p>

        <p>
          Example (generic) API Responses for successful API request:
        </p>
<div class="pre-div"><pre>
{
  "error": false
}
</pre></div>

        <p>
          Example (generic) API Responses for a miscellaneous state error:
        </p>
<div class="pre-div"><pre>
{
  "error": true,
  "message": "IRC server not connected"
}
</pre></div>
        <p>
          Websocket IRC server messages are formed by prefixing a timestamp in front of
          of verbatim RFC 2812 IRC server message delimited by end-of-line characters.
          Due to the nature of a text stream buffered I/O, it is possible that
          the one buffer of stream data could contain multiple IRC messages or that a single
          IRC message could be split, half arriving in one buffer and half in the next buffer.
          For reference, RFC 2812 can be viewed at
          <a href="https://datatracker.ietf.org/doc/html/rfc2812">
            https://datatracker.ietf.org/doc/html/rfc2812</a>.
        </p>
<div class="pre-div"><pre>
@time=2021-06-18T21:13:06.949Z :myNickName!*@* PRIVMSG #mychannel :Hi, i'm typing a IRC channel message
</pre></div>

        <p>
          Example Websocket Message (generic) for a network connection error being
          returned asynchronously over websocket stream:
        </p>
<div class="pre-div"><pre>
"webError: IRC server timeout while connecting"
</pre></div>

        <p>
          Example Websocket Message (generic) for general info messages over the websocket:
        </p>
<div class="pre-div"><pre>
"webServer: Opening socket to test-server 192.168.1.127:6667"
</pre></div>
        <p>
          A more detail description of web socket usage is included near the bottom of this page.
        </p>

        <h1>API Authorization</h1>

        <h3>Cookies</h3>

        <p>
          HTTP requests to the web server API require a session cookie with a valid digital signature.
          API requests made to any protected API without a valid cookie will return
          status 403 Forbidden.
        </p><p>
          The user should have previously obtained a cookie by loading the page at 
          &quot;/irc/webclient.html&quot;.
          The web server will check for a valid cookie.
          In the case of a missing, invalid or expired cookie, the users web
          browser is redirected from /irc/webclient.html to the proper form for entry of username and password. 
          After successful password entry, the browser is redirected back to /irc/webclient.html with
          a new valid cookie.
        </p>

        <h3>CSRF Tokens</h3>
        <p>
          Cross site request forgery is a security concern where html &lt;form&gt; elements
          are used to submit data using the form's submit button with method POST.
          A malicious page would attempt to trick a user to clicking an embedded form causing
          data to be submitted to a different web site where the user previously obtained a valid cookie. 
          A CSRF token is a random nonce that is embedded into the HTML of a web page. 
          It changes each time the page is reloaded to a new random value.
        </p>
        <p>
          The hrc-hybrid-client web server requires CSRF tokens for HTTP methods 
          that change state, such as the POST methods.
          The CSRF token is obtained by using JavaScript to parse the token data from the HTML code
          in /irc/webclient.html as shown in this example.
        </p>
<div class="pre-div"><pre>
  &lt;head&gt;
    &lt;meta name="csrf-token" content="ob1P2QF3-bBXabc8At9xxiJyC2I44sAbjgsA"&gt;
  &lt;/head&gt;
</pre></div>

        <p>
          When performing a HTTP request using the POST method, the CSRF token 
          can be added to the request headers as follows:
        </p>
<div class="pre-div"><pre>
  &quot;accept&quot;: &quot;application/json&quot;,
  &quot;csrf-token&quot;: &quot;ob1P2QF3-bBXabc8At9xxiJyC2I44sAbjgsA&quot;,
  &quot;content-type&quot;: &quot;application/json&quot;,
</pre></div>
        
        <p>Requests with missing or invalid CSRF tokens will return 403 Forbidden &quot;invalid csrf token&quot;</p> 

        <h1>IRC Client API Routes</h1>

        <h3>POST /irc/server</h3>

        <p>
          The backend NodeJs web server maintains a list of available IRC servers.
          This list is loaded from a configuration file &quot;servers.json&quot;.
          Calls to /irc/server shall include an &quot;index&quot; property of type integer
          that is used to select a specific server.
        </p>
        <ul>
          <li>A value of 0 or greater is used to specify the index of an IRC server in the list.</li>
          <li>A value of -1 is used to rotate to the next server in the configuration.</li>
          <li>A value of -2 is used to rotate to the previous server in the configuration.</li>
        </ul>

        <p>
          In the case where the change in selected IRC server causes a change in IRC server group number, 
          or if the requested IRC server number is equal to zero, the IRC message cache 
          on the web server will be cleared. The web server will then send a 
          &quot;CACHERESET&quot; command to all connected web browsers over the websocket connection.
          The web browser will interpret this command as a change in IRC networks.
          The browser will clear all relevant textarea elements in order to prevent previously received
          messages on one IRC network from being displayed as if
          they were received from a different IRC network. 
          In the case where more than one web browser is concurrently connected to the 
          web server this will force all connected web browsers will remain synchronized
          with the empty message buffer on the web server.
        </p>

        <p>
          When the web server configuration changes to index a different IRC server,
          an "UPDATE" command is sent to the browser over the websocket stream.
          Upon receipt of the UPDATE request, the browser should perform a GET request to route /irc/getircstate.
          The getircstate response contains updated server configuration in JSON format.
          (see getircstate below)
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
  "index": -1
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
  "error": false,
  "index": 2,
  "name": "DALnet"
}
</pre></div>

<p>Error Response:</p>
<div class="pre-div"><pre>
{
  "error": true,
  "message": "Requested server index number out of range."
}
</pre></div>

        <h3>POST /irc/connect</h3>

        <p>
          Calls to the connect API are used to request the backend NodeJs web server
          to initiate an IRC client connection to the IRC server.
          The nickName and realName are required properties of type UTF-8 string.
          The IRC user name (identd alternate user) is not editable from the browser and
          therefore excluded from this schema.
          The initial userMode property is optional.
        </p>

        <p>
          Connection to an IRC server involves several steps, such as opening a TCP socket,
          sending commands to set nickname and other IRC formation. As the connection is
          established, the irc state object located in the web server is updated.
          Each time the state changes, an "UPDATE" command is sent to the browser
          over the web socket stream.
          Upon receipt of the UPDATE request, the browser should perform a GET request to route /irc/getircstate
          and update the user interface from information returned in the state object.
          (see getircstate below)
        </p>

<p>POST Request Body</p>
<div class="pre-div"><pre>
{
  "nickName": "myNickName",
  "realName": "John Doe",
  "userMode": ""
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
    "error": false
}
</pre></div>

<p>Error Response:</p>
<div class="pre-div"><pre>
{
    "error": true,
    "message": "Error: already connected to IRC server."
}
</pre></div>

        <h3>POST /irc/message</h3>

        <p>
          Calls to this API are used to send RFC 2812 IRC messages from web browser
          to the NodeJs backend server for re-transmission to the IRC server.
        </p>
        <p>
          The request body should contain a &quot;message&quot; property of type UTF-8 string
          containing the RFC 2812 IRC message.
          Multiple messages are not allowed. The end-of-line characters should not be included.
        </p>

        <p>
          Assuming the IRC command is accepted by the IRC server, the IRC response is
          sent to the browser via the websocket stream as a standard RFC 2812 IRC message.
          These messages are UTF-8 text and delimited by return and end-of-line
          characters 0x10 and 0x13 (&quot;&#92;r&#92;n&quot;). See RFC 2812 for specification of these messages.
        </p>

        <p>
          Issuing some commands to the IRC server may result in a state change of the IRC client.
          One example would be a command to JOIN an IRC channel.
          Some commands, such as PRIVMSG may not cause a state change.
          Each time the state changes, an "UPDATE" command is sent to the browser
          over the web socket stream.
          Upon receipt of the UPDATE request, the browser should perform a GET request to route /irc/getircstate
          and update the user interface from information returned in the state object.
          (see getircstate below)
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
  "message": "PRIVMSG #mychannel :Hello World"
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
    "error": false
}
</pre></div>

<p>Error Response:</p>
<div class="pre-div"><pre>
{
    "error": true,
    "message": "Can not send server message when IRC server not connected"
}
</pre></div>

<p>Websocket Response (IRC server PRIVMSG message in stream)</p>
<div class="pre-div"><pre>
@time=2021-06-18T20:09:38.944Z :myNickName!*@* PRIVMSG #test :hello, how are you
</pre></div>

<p>Example Request causing IRC server to issue an error as IRC message
by sending invalid server name with TIME request.</p>
<div class="pre-div"><pre>
{
  "message": "TIME invalid.server.name"
}
</pre></div>

<p>Websocket Error Response (IRC server 402 error message in stream)</p>
<div class="pre-div"><pre>
@time=2021-06-18T20:05:26.538Z :irc.example.com 402 myNickName invalid.server.name :No such server
</pre></div>

        <h3>GET /irc/getircstate</h3>

        <p>
          The actual IRC client is located within the NodeJs backend web server.
          API calls to route /irc/getircstate will retrieve a JSON object containing
          all relevant state information for the IRC client connection and IRC channel membership.
        </p>

        <p>
          The web browser should listen for a websocket stream message containing a string matching &quot;UPDATE&quot;.
          When an UPDATE is received as a single line message delimited by 0x10,0x13, (...&#92;r&#92;nUPDATE&#92;r&#92;n...)
          the browser javascript should fetch a GET request to the /irc/getircstate route.
          The browser should then parse the state object for changes and update the user interface as needed.
        </p>

        <p>
          This example shows the websocket stream during a conversation between two
          people, while a third new person joins the channel. The IRC server sends a JOIN
          message which is passed through to the browser. In the backend NodeJs web server,
          the new user nickname is added to the list of channel members.
          The UPDATE command is sent to the browser in the websocket stream.
        </p>


<p>Websocket stream showing JOIN to channel and UPDATE command.</p>
<div class="pre-div"><pre>
@time=2021-06-18T21:13:06.949Z :myNickName!*@* PRIVMSG #test :Hello, how are you doing
@time=2021-06-18T21:14:16.322Z :otherName!*@* PRIVMSG #test :I am doing fine, how are you
@time=2021-06-18T21:15:26.412Z :myNickName!*@* PRIVMSG #test :I am fine also, I have to run
@time=2021-06-18T21:16:03.212Z :otherName!*@* PRIVMSG #test :OK, bye for now
@time=2021-06-18T21:21:11.393Z :Mary!newuser@1.2.3.4.example.net JOIN :#MyChannel
UPDATE
@time=2021-06-18T21:22:20.433Z :myNickName!*@* PRIVMSG #test :Hello Mary, how are you doing?
</pre></div>

        <p>
          The browser should act on the UPDATE command by obtaining a new state object
          which contains an updated array containing channel member nicknames.
        </p>

<p>API response to GET /irc/getircstate</p>
<div class="pre-div"><pre>
{
    "ircConnectOn": true,
    "ircConnecting": false,
    "ircConnected": true,
    "ircRegistered": true,
    "ircIsAway": false,
    "nickRecoveryActive": false,
    "userHost": "~someuser@somehose.example.net",
    "connectHost": "~someuser@somehose.example.net",
    "lastPing": "0.022",
    "ircSockInfo": {
      "encrypted": true,
      "verified": true,
      "protocol": "TLSv1.3"
    }
    "ircServerIndex": 0,
    "ircServerGroup": 0,
    "ircServerName": "freenode",
    "ircServerHost": "chat.freenode.net",
    "ircServerPort": 7000,
    "ircTLSEnabled": true,
    "ircTLSVerify": true,
    "ircProxy": false,
    "ircAutoReconnect": true,
    "ircServerRotation": true,
    "nickName": "myNickName",
    "userName": "myNickName",
    "realName": "myNickName",
    "userMode": "+i",
    "channelList": [],
    "ircServerIndex": 3,
    "ircServerPrefix": "tildes.freenode.net",
    "channels": [
      ""#mychannel"
    ],
    "channelStates": [
      {
        "name": "#mychannel",
        "csName": "#MyChannel"
        "topic": "Welcome to #MyChannel cool topic message",
        "names": [
          "@myNickName",
          "@otherName",
          "Mary"
        ],
        "joined": true,
        "kicked": false
      }
    ],
    "enableSocks5Proxy": true,
    "socks5Host": "socks5.example.com",
    "socks5Port": 10080,
    "progVersion": "0.2.8",
    "progName": "irc-hybrid-client",
    "times": {
        "programRun": "1624047717",
        "ircConnect": "1624047739"
    },
    "count": {
        "ircConnect": 1,
        "ircConnectError": 0,
        "ircStateCalls": 20
    },
    "websocketCount": 1,
    "disableServerListEditor": false,
    "customBeepSounds": false
}
</pre></div>

        <h3>POST /irc/prune</h3>

        <p>
          This is used to remove a non-joined IRC channel from the active channel list.
          Trying to prune a channel while present in the channel will cause an error.
          Pruning a channel will delete the IRC message cache buffer associated with the pruned channel.
          In the case where the maximum count of IRC channel message buffers was exceeded, the prune 
          function will erase channel messages from the default IRC message cache.
        </p>
        <p>
          The request body shall contain the property &quot;channel&quot; of type string
          containing the channel name.
        </p>

<p>POST Request Body</p>
<div class="pre-div"><pre>
{
  "channel": "#test"
}
</pre></div>

        <h3>GET /irc/cache</h3>

        <p>
          The web server maintains a cache of IRC server messages
          messages (lines of text) in RFC 2812 format.
          Performing a GET request to /irc/cache will return a response containing
          and array of elements of type string. Each array string element represents
          a previous cached IRC server message.
        </p>

        <p>
          When using this IRC client on an iPhone, there are issues where the websocket
          is disconnected when the screen lock is enabled. Before using this API, the browser
          will clear all previous channel messages, private messages and server messages.
          From the API response, each string in the cache array can be parsed one by one
          as if they had just arrived from the IRC server. This will restore the
          user interface to show messages that may have arrived while the websocket was disconnected.
        </p>

        <p>
          Starting with version v0.2.14, the message cache consists of one cache buffer for 
          IRC server messages, those being messages which are not related to a specific IRC channel.
          Additional cache buffers are created for each IRC channel up to a maximum limit.
          When the limit is exceeded, IRC messages from extra IRC channels are 
          cached in the default server message cache. In response to the API call, all 
          cache buffers are concatenated before sending. A section of messages from 
          a single IRC channel cache would be in chronological order within that IRC channel.
          The web browser will restore the display independently for each IRC channel, so 
          a channel window will be properly ordered. Combined, however, the overall set of messages 
          may be out of chronological order between different cache buffers.
        </p>

        <p>
          The size of the cache is 100 messages per buffer. There is 1 default server 
          buffer and 5 additional IRC channel buffers.
          Therefore up to 600 IRC messages could be returned.
          This is intended to ride out a screen lock. It is not meant to be an offline client.
          Over time messages will cycle out of the cache and may be lost without viewing.
        </p>

<p>Example API response:</p>
<div class="pre-div"><pre>
[
  "@time=2021-06-18T21:13:06.949Z :myNickName!*@* PRIVMSG #test :Hello, how are you doing",
  "@time=2021-06-18T21:14:16.949Z :otherName!*@* PRIVMSG #test :I am doing fine, how are you",
  "@time=2021-06-18T21:15:26.949Z :myNickName!*@* PRIVMSG #test :I am fine also, I have to run",
  "@time=2021-06-18T21:16:03.949Z :otherName!*@* PRIVMSG #test :OK, bye for now"
]
</pre></div>

        <p>
          In the IRC protocol, QUIT messages do not include the IRC channel name. 
          It is up to the IRC client to maintain a list of channel members and apply 
          the QUIT message to the proper channel(s).
          With a chronological linear message cache, orphan QUIT messages in the cache 
          belonging to an IRC user who has left before the cache was restored are 
          not able to be matched to the any active channel windows.
          To address this, in v0.1.14 a new IRC message type was created as `cachedQUIT`. 
          The format is similar to the standard QUIT message except an additional field
          has been added for the IRC channel name. 
          In the cache, the cachedQUIT message is duplicated for each IRC channel.
          As real time messages are received from the IRC server, standard QUIT messages
          are parsed directly. When the browser content is deleted and restored from
          the IRC message cache, the alternate cachedQUIT messages are used.
        </p>
        <p>
          In v0.2.16, similar code was added for the NICK command. A new IRC 
          message cachedNICK was created. The NICK message is duplicated
          for each IRC channel where the NICK is applicable.
        </p>

<p>Example showing QUIT, cachedQUIT, NICK, and cachedNick messages</p>        
<div class="pre-div"><pre>

Live message:
@time=2022-09-04T22:24:33.083Z :nickname!~user@192.168.1.1 QUIT :test QUIT message
@time=2022-09-04T22:25:22.144Z :oldNickname!~user@192.168.1.1 NICK :newNickname

Cached message with 2 IRC channels.
@time=2022-09-04T22:24:33.082Z :nickname!~user@192.168.1.1 cachedQUIT #channelName :test QUIT message
@time=2022-09-04T22:24:33.082Z :nickname!~user@192.168.1.1 cachedQUIT #otherChannel :test QUIT message
@time=2022-09-04T22:25:22.144Z :oldNickname!~user@192.168.1.1 cachedNICK #channelName :newNickname

</pre></div>

        <h3>POST /irc/erase</h3>

        <p>
          This API is used to delete the contents of the IRC message cache.
          The entire message cache may be erased and reinitialized, or
          specific message types may be erased from the cache.
        </p>
        <p>
          The primary purpose for cache erase is to remove previous content
          when changing from one IRC network to a different IRC network.
        </p>
        <p>
          The erase function may also be used to manage the number of panels in the web browser.
          When the web browser connects to the web server, the entire message 
          cache is sent to the browser. In the browser, different panels will open 
          automatically to display different types of data, such as
          IRC channel PRIMVSG messages, PM messages, NOTICES and WALLOPS messages.
          There was a tendency to open extraneous panels to display past 
          IRC messages that were no longer relevant, making the browser interface 
          cluttered with extra panels. This API allows cached data for specific 
          panels to be deleted independently. This in turn eliminates unnecessary
          browser panels from being opened automatically.
        </p>
        <p>
          A target specifier is required to determine the scope of the erase function.
          The target specifier in an &quot;erase&quot; property in the body of the POST request.
          Valid values are:
        </p>
        <ul>
          <li>
            CACHE - Erase entire IRC server message cache.
            If the message cache contains valid data when the erase request is received, 
            the web server will send a &quot;CACHERESET&quot; command to all connected
            web browsers over the websocket connection.
            The CACHERESET command will cause all connected web browsers to 
            clear all related textarea elements.
          </li>
          <li>
            WALLOPS - This will identify and erase WALLOPS message in the default message cache.
            The web server then sends a &quot;CACHEPULL&quot; command to all 
            connected web browsers over the websocket connection.
            The CACHEPULL command will cause all connected web browsers to reload 
            the entire message cache and update textarea elements accordingly.
          </li>
          <li>
            NOTICE - This will identify and erase NOTICE message in the default message cache.
            The web server then sends a &quot;CACHEPULL&quot; command to all 
            connected web browsers over the websocket connection.
            The CACHEPULL command will cause all connected web browsers to reload 
            the entire message cache and update textarea elements accordingly.
          </li>
          <li>
            PRIVMSG - This will identify and erase all user PRIVMSG messages 
            in the default message cache. Channel PRIVMSG message will not be erased.
            The web server then sends a &quot;CACHEPULL&quot; command to all 
            connected web browsers over the websocket connection.
            The CACHEPULL command will cause all connected web browsers to reload 
            the entire message cache and update textarea elements accordingly.
          </li>
        </ul>
<p>Example POST Request Body:</p>
<div class="pre-div"><pre>
{
  "erase": "CACHE"
}
</pre></div>


        <h3>POST /irc/disconnect</h3>

        <p>
          This is an emergency function used to forcibly close the socket to the IRC server.
          In routine operation, IRC connections should be closed by sending
          an RFC 2812 &quot;QUIT&quot; command to the web server for
          re-transmission to the IRC server as a normal IRC command.
          The body of the request should contain an empty JSON object "{}".
        </p>

<p>POST Example body:</p>
<div class="pre-div"><pre>
{
}
</pre></div>

        <h3>POST /terminate</h3>

        This is essentially a &quot;die&quot; function to forcibly shutdown the NodeJs web server.
        A confirmation flag of type boolean is required in a &quot;terminate&quot; property
        in the POST body.

<p>POST Example body:</p>
<div class="pre-div"><pre>
{
  "terminate": "YES"
}
</pre></div>

        <div class="desc-title">
          Server List Editor API
        </div>

        <p>
          The server list editor web page located at &quot;/irc/serverlist.html&quot;
          is used to view the list of available IRC server definitions.
          Individual IRC servers can be modified using a simple HTML form editor.
          The purpose of the API located at &quot;/irc/serverlist&quot; is to service the 
          associated HTML page.
        </p><p>
          Modification of the list of IRC servers operates independently of the 
          IRC web client. The IRC client must be disconnected from all IRC servers
          in order to use these API calls to modify the list of IRC servers. 
        </p><p>
          The list of IRC servers is stored in the base folder of the IRC web 
          server in the file &quot;servers.json&quot;
          The file may be edited manually instead of using this interface.
        </p><p>
          The IRC server list editor can be disabled by setting 
          &quot;disableServerListEditor: true&quot; in the credentials.json file
          or by setting the environment variable &quot;IRC_DISABLE_LIST_EDITOR=true&quot;
           When disabled, all attempts to access the 
          /irc/serverlist API will return Status 405 Method not allowed 
          &quot;Server List Editor Disabled&quot;
        </p><p>
          The API supports several methods, such as GET, POST, PATCH, COPY, and DELETE
          which are used to perform various tasks.
        </p>
        <p>
          Errors that occur during input validation checking will return 
          Status 422 Unprocessable entity.
        </p>
        <p>
          The fields used for IRC server password, SASL password,  and user's NickServ command
          are write only fields. New values may be submitted, but existing values
          are not returned by the API. However, these values are stored
          un-encrypted in plain text in the servers.json file, and may be viewed there.
        </p>

        <h3>GET /irc/serverlist (without params)</h3>

        <p>
          Submitting a GET request without any URL query parameters will return 
          the complete list of IRC server definitions from the servers.json file.
          The response is a JSON encoded array of javascript objects.
          The list of IRC channels is a comma separated list.
        </p>

<p>API response to GET /irc/serverlist</p>
<div class="pre-div"><pre>
[
    {
      "index": 0,
      "disabled": false,
      "group": 0,
      "name": "DALnet-1",
      "host": "lion.dal.net",
      "port": 6697,
      "tls": true,
      "verify": true,
      "proxy": false,
      "reconnect": false,
      "logging": true,
      "identifyNick": "",
      "nick": "MyNickName",
      "altNick": "",
      "recoverNick": false,
      "user": "user",
      "real": "John Doe",
      "modes": "+i",
      "channelList": "#myChannel, #otherChannel"
  },
  {
    "index": 1,
    "disabled": false,
    "group": 0,
    "name": "DALnet-2",
    "host": "irc.dal.net",
    "port": 6667,
    "tls": false,
    "verify": false,
    "proxy": false,
    "reconnect": false,
    "logging": true,
    "identifyNick": "",
    "nick": "MyNickName",
    "altNick": "",
    "recoverNick": false,
    "user": "user",
    "real": "John Doe",
    "modes": "+i",
    "channelList": "#myChannel, #otherChannel"
  }
]
</pre></div>

        <h3>GET /irc/serverlist?index=0&lock=1</h3>

        <p>
          Submitting a GET request with a query parameter &quot;index&quot;
          will return the individual server definition with the specified index number.
          Specification of the query parameter &quot;lock=1&quot; will attempt to 
          check out the record for editing by placing a lock flag on the database.
          Repeating the same request with &quot;lock=0&quot; will clear the lock flag .
        </p>
        <p>
          The purpose of this request is to checkout and open an existing 
          IRC server definition for editing. When editing complete,
          the modified data would be returned using the PATCH method shown further below.
        </p>

<p>API response to GET /irc/getircstate?index=0&lock=1</p>
<div class="pre-div"><pre>
{
  "index": 0,
  "disabled": false,
  "group": 0,
  "name": "DALnet",
  "host": "lion.dal.net",
  "port": 6697,
  "tls": true,
  "verify": true,
  "proxy": false,
  "reconnect": false,
  "logging": true,
  "identifyNick": "",
  "nick": "MyNickName",
  "altNick": "",
  "recoverNick": false,
  "user": "user",
  "real": "John Doe",
  "modes": "+i",
  "channelList": "#myChannel, #otherChannel"
}
</pre></div>

        <p>
          Error responses: 
        </p>
        <ul>
          <li>Status 400 Bad Request &quot;Server list array index out of range&quot;</li>
          <li>Status 409 Conflict &quot;Lock already set&quot;</li>
        </ul>

        <h3>POST /irc/serverlist</h3>

        <p>
          The POST method is used to create a new IRC server definition.
          The database should be unlocked for this request.
          A valid CSRF token is required in the request headers as described above.
        </p>
        <p>
          The request must not include an &quot;index&quot; property because a 
          new index will be automatically generated when the record is created.
        </p>
        <p>
          The properties &quot;password&quot;, &quot;saslPassword&quot; and &quot;identifyCommand&quot;
          are optional. If the POST request includes these properties, they will be part
          of the server definition. An empty string may be submitted, such as: password:&quot;&quot; 
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
  "disabled": false,
  "group": 0,
  "name": "DALnet",
  "host": "lion.dal.net",
  "port": 6697,
  "tls": true,
  "verify": true,
  "proxy": false,
  "reconnect": false,
  "logging": true,
  "password": "",
  "saslUsername": "",
  "saslPassword": "",
  "identifyNick": "",
  "identifyCommand": "",
  "nick": "MyNickName",
  "altNick": "",
  "recoverNick": false,
  "user": "user",
  "real": "John Doe",
  "modes": "+i",
  "channelList": "#myChannel, #otherChannel"
}  
</pre></div>

        <p>
          The response body will include the index number of the new record.
        </p>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
  "status": "success",
  "method": "POST",
  "index": 4
}
</pre></div>

<p>Error Response:</p>
<ul>
  <li>Status 409 Conflict &quot;Attempt to modify locked data table&quot;</li>
</ul>

<p>Input Validation Error Response: (Missing port number)</p>
<div class="pre-div"><pre>
{
  "status": 422,
  "message": "Unprocessable Entity",
  "errors": [
      {
          "msg": "Required values",
          "param": "port",
          "location": "body"
      },
      {
          "msg": "Invalid socket port number",
          "param": "port",
          "location": "body"
      }
  ]
}
</pre></div>

<h3>PATCH /irc/serverlist?index=xxx</h3>

<p>
  The PATCH method is used to modify an existing IRC server definition.
  Prior to calling the PATCH method, a current copy of the data
  should be retrieved using GET /irc/serverlist?index=xxx?lock=1.
  The GET request query parameter &quot;lock=1&quot; will set a lock flag
  with the index value for this record.
  Successful completion of this request will remove the lock flag automatically.
  A valid CSRF token is required in the request headers as described above.
</p>
<p>
  The index parameter is required as a URL query parameter. 
  The index value specified in the body of the request must match the index
  value in the URL query parameters.
</p>
<p>
  The properties &quot;password&quot;, &quot;saslPassword&quot; and 
  &quot;identifyCommand&quot; are optional. 
  In the example below, these propertires are omitted.
  If the PATCH request includes these properties, 
  any existing value will be replaced. If the properties are 
  omitted from the object, no changes will be made to hose properties 
  in the original record.
  The GET request will not include these existing values for security concerns.
  An empty string can be sent to remove a previous value (i.e. no server password).
  In the example below, they are omitted, retaining existing values.
</p>
<p>
  It is also possible to edit the existing servers manually in the 
  servers.json file using a text editor.
</p>

<p>PATCH Request Body:</p>
<div class="pre-div"><pre>
{
  "index": 0,
  "disabled": false,
  "group": 0,
  "name": "DALnet",
  "host": "lion.dal.net",
  "port": 6697,
  "tls": true,
  "verify": true,
  "proxy": false,
  "reconnect": false,
  "logging": true,
  "saslUsername": "",
  "identifyNick": "",
  "nick": "MyNickName",
  "altNick": "",
  "recoverNick": false,
  "user": "user",
  "real": "John Doe",
  "modes": "+i",
  "channelList": "#myChannel, #otherChannel"
}  
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
"status": "success",
"method": "PATCH",
"index": 0
}
</pre></div>

<p>Error Response:</p>
<ul>
<li>Status 409 Conflict &quot;Attempt to modify unlocked data table&quot;</li>
</ul>

<p>Input Validation Error Response: (Missing port number)</p>
<div class="pre-div"><pre>
{
  "status": 422,
  "message": "Unprocessable Entity",
  "errors": [
    {
      "msg": "Required values",
      "param": "port",
      "location": "body"
    },
    {
      "msg": "Invalid socket port number",
      "param": "port",
      "location": "body"
    }
  ]
}
</pre></div>

        <h3>COPY /irc/serverlist?index=xxx</h3>

        <p>
          The COPY method is used to duplicate one of the existing records
          and append the duplicated copy to the end of the server list arrray.
        </p>
        <p>
          The index parameter is required as a URL query parameter. 
          The index value specified in the body of the request must match the index
          value in the URL query parameters.
          The index property in the response body will point to the index of
          the new record created by the request.
        </p>

<p>COPY Request Body:</p>
<div class="pre-div"><pre>
{
  "index": 0
} 
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
  "status": "success",
  "method": "COPY",
  "index": 3
}
</pre></div>

        <p>Error Response:</p>
        <ul>
        <li>Status 409 Conflict &quot;Attempt to modify locked data table&quot;</li>
        </ul>

        <h3>DELETE /irc/serverlist?index=xxx</h3>

        <p>
          The DELETE method will remove and delete the record at the specified index.
          The remaining records will be renumbered.
          The response body will include the index number of the deleted record.
          The database must be unlocked to the DELETE method.
        </p>
        <p>
          The index parameter is required as a URL query parameter. 
          The index value specified in the body of the request must match the index
          value in the URL query parameters.
        </p>
        <p>
          The body of the request may include other valid properties. Only the 
          &quot;index&quot; property is used by the DELETE method.
          Other valid properties are ignored. Extraneous unrecognized properties will 
          generate an error.
        </p>

<p>DELETE Request Body:</p>
<div class="pre-div"><pre>
 {
  "index": 2,
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
  "status": "success",
  "method": "DELETE",
  "index": 3
}
</pre></div>

        <p>Error Response:</p>
        <ul>
        <li>Status 409 Conflict &quot;Attempt to modify locked data table&quot;</li>
        </ul>

        <h3>POST /irc/serverlist/tools?index=0</h3>

        <p>
          A &quot;tools&quot; API can be used to perform various toolbox functions
          to the server list.
          The selection is based on the &quot;action&quot; property in the 
          body of the request.  The following actions are available.
        </p>

        <h3>POST /irc/serverlist/tools?index=xxx with action: 'move-up'</h3>

        <p>
          When action is set to &quot;move-up&quot;
          the record at the specified index is moved up to the next decremented index number.
          The up direction will lower the index number by 1 moving records towards index 0.
          The record at index 0 can not be moved, and the request will be ignored without error.
          The index property in the response body will point to the index of
          the relocated record.
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
 {
  "index": 2,
  "action": "move-up"
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
  "status": "success",
  "method": "POST",
  "index": 1
}
</pre></div>

<h3>POST /irc/serverlist/tools?index=xxx with action: 'toggle-disabled'</h3>

<p>
  When action is set to &quot;toggle-disabled&quot;
  the record at the specified index will toggle the &quot;disabled&quot; property
  between true and false.
  The index property in the response body will point to the index of
  the modified record. The new value of the disabled property will
  be returned in the body of the response as a boolean &quot;value&quot; property.
</p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
"index": 2,
"action": "toggle-disabled"
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
"status": "success",
"method": "POST",
"index": 2,
"value": false
}
</pre></div>


        <p>Error Response:</p>
        <ul>
        <li>Status 409 Conflict &quot;Attempt to modify locked data table&quot;</li>
        </ul>

        <div class="desc-title">
          Websocket Interface
        </div>
        <p>
          In a typical IRC client program, such as mirc or hexchat, the client IRC program
          establishes a bi-directional TCP network socket connection between the IRC client and the
          IRC server. The client software sends IRC commands and channel text messages over the
          TCP socket. The IRC server responds asynchronously with RFC 2812 messages over the
          TCP network socket.
        </p>
        <p>
          In the irc-hybrid-client program, the backend web server serves as the IRC client.
          The backend maintains the IRC server TCP socket connection.
          The backend is capable to maintain a valid IRC user connection independent of the web
          browser. Therefore, IRC server messages related to connection status, channel
          membership, and other state is parsed and maintained within the backend server.
        </p>
        <p>
          Although a summary of IRC connection state can be retrieved over the /irc/getircstate API,
          as described above, the ircState json object does not contain text messages from other users.
        </p>
        <p>
          Independent of the TCP socket connection between the backend and the IRC server,
          the web browser opens an independent websocket connection to the backend webserver,
          using ws:// or wss:// protocol standard websocket connections.
          The websocket passes a stream of utf-8 characters.
          Each message is delimited by CR,LF end of line characters (&quot;\r\n&quot;).
        </p>
        <p>
          All RFC 2812 messages from the web server are passed through the backend.
          A copy of each message is echoed to the web browser in utf-8 format over the websocket.
          JavaScript in the web browser parses the messages to identify text messages from
          other IRC users. User text messages are then displayed as text content in the appropriate windows.
        </p>
        <p>
          The backend contains list of excluded commands in an array &quot;excludedCommands = [&quot;PING&quot;, &quot;PONG&quot;].
          Messages between the backend and the IRC server that contain PING or PONG commands are not sent to the browser.
          This is to avoid scrolling valid messages out of the IRC message cache buffer.
        </p>
        <p>
          The websocket stream also contain command messages intended to initiate browser actions.
          There are 6 types of command defined in the following table.
          Each message type begins with a specific prefix string as shown in the first table column.
        </p>
        <p>
          Any message not beginning with a command prefix string is considered to be a valid
          RFC 2812 IRC server message. Valid RFC 2812 messages are prefixed with a timestamp
          in IRC_V3 format.
        </p>

        <table class="table-generic">
          <tbody>
            <tr>
              <th>Prefix</th>
              <th>Description</th>
            </tr>
            <tr>
              <td>HEARTBEAT</td>
              <td>
                The web server will send a HEARTBEAT message over the websocket each
                10 seconds. It is the responsibility of the web browser javascript
                to monitor these recurring messages. Absence of the HEARTBEAT messages
                shows the websocket is no longer actively connected to the web server.
              </td>
            </tr>
            <tr>
              <td>UPDATE</td>
              <td>
                UPDATE is a command to instruct the browser to call route /irc/getircstate in response to a
                change in the ircState object in the backend. For example, when a
                person departs an IRC channel, the departing user's nick name is
                removed from the array of channel membership within the backend ircState object.
                An UPDATE request is sent to the web browser.
                In response the UPDATE message, the browser performs an API call to the
                /irc/getircstate route to obtain a new copy of the ircState object.
                The ircState object is parsed by the browser and the channel membership
                name list is updated in the appropriate channel window.
              </td>
            </tr>
            <tr>
              <td>CACHERESET</td>
              <td>
                CACHERESET is a command that will instruct all connected web browsers to clear the 
                content of all related textarea elements. The primary purpose is to clear 
                content from one IRC network from being displayed after a new connection is 
                made to a different IRC network. The CACHERESET command is sent by the server when it detects
                a change in server group number. It is also sent to all connected web browsers 
                in response to an API call to the /irc/erase route.
              </td>
            </tr>
            <tr>
              <td>CACHEPULL</td>
              <td>
                CACHEPULL is a command will instruct all connected web browsers
                to reload the entire message cache from the web server and update
                all textarea elements accordingly.
                The CACHEPULL command is sent by the server when one specific part of the 
                IRC message cache has been erased using the POST /irc/erase route.
                This will allow extraneous windows to be removed after the 
                content is no longer relevant and has been deleted from the message cache.
              </td>
            </tr>
            <tr>
              <td>LAG=0.001</td>
              <td>
                Each time the backend IRC client sends a PING command to the IRC server, 
                the delay time for the server PONG response is measured.
                The time value in seconds is sent to the browser over the websocket 
                using a message as a string in the following format: "LAG=x.xxx\r\n".
              </td>
            </tr>
            <tr>
              <td>webServer:</td>
              <td>
                Prefix to indicate an informational message from the backend.
                The webServer messages are primarily intended to show IRC client
                events that are intended for debugging. The webServer messages are
                not intended for display to the IRC user.
              </td>
            </tr>
            <tr>
              <td>webError:</td>
              <td>
                Prefix to indicate an error has been detected by the backend while acting
                as an IRC client program.
                The expectation is that contents of the error are displayed to the IRC user
                as a valid error message within the web page.
              </td>
            </tr>
            <tr>
              <td>--&gt;</td>
              <td>
                The prefix &quot;--&gt;&quot; is an indicator to specify copies of outgoing messages that are
                sent from the backend web server to the IRC server.
                Outgoing messages are echoed verbatim to all connected web browsers.
                Some IRC commands containing possible passwords may be filtered.
                Visibility of the exact messages sent to the IRC server can be useful
                when troubleshooting software errors.
                These outgoing messages can be viewed in the IRC client Server window
                by clicking checkboxes for [x]View-Raw and [x]Add-Comms.
                These are outgoing messages. There is no assurance the IRC server accepted them without error.
                Therefore, these messages should be considered as informational only for debug purposes.
                Messages starting with &quot;--&gt;&quot; should not be parsed by the browser for content.
                As shown in the following example,
                the user +i user mode change should be parsed from the (incoming)
                &quot;MODE&quot; IRC message, not the (outgoing) &quot;--&gt;&quot; debug message.
              </td>
            </tr>
          </tbody>
        </table>
        <p>
          The following example shows a sample of websocket messages.
        </p>
<div class="pre-div"><pre>
HEARTBEAT
HEARTBEAT
UPDATE
webServer: Opening socket to irc.example.com:6667
webServer: Connected
webServer: Ready
--> NICK myNick
--> USER myUsername 0 * :John Doe
UPDATE
@time=2021-07-19T11:56:30.532Z :irc.example.com 001 myNick :Welcome to the Internet Relay Network myNick!~myUsername@192.168.1.182
@time=2021-07-19T11:56:31.532Z :irc.example.com 002 myNick :Your host is irc.example.com, running version ngircd-25 (x86_64/pc/linux-gnu)
@time=2021-07-19T11:56:31.532Z :irc.example.com 003 myNick :This server has been started Thu Jul 15 2021 at 18:12:20 (UTC)
@time=2021-07-19T11:56:31.532Z :irc.example.com 004 myNick irc.example.com ngircd-25 abBcCFiIoqrRswx abehiIklmMnoOPqQrRstvVz
--> MODE myNick +i
@time=2021-07-19T11:56:32.533Z :myNick!~myUsername@192.168.1.182 MODE myNick :+i
UPDATE
HEARTBEAT
HEARTBEAT
LAG=0.023
HEARTBEAT
</pre></div>

        <div class="desc-title">
          API Manual Testing
        </div>
        <p>
          Manual testing of the backend web server requires two tools. One to issue
          http GET and POST methods to the web server. These API requests initiate subsequent
          RFC 2812 IRC commands which are sent asynchronously to the IRC server.
          A second tool is required to observe the asynchronous RFC 2812 IRC messages which
          originate in the IRC server and are passed through the web server and
          onward to the web browser using the websocket stream connection.
          The following documentation will explain using Postman to issue API requests.
          Postman is used in combination with a custom websocket monitoring tool included in the repository.
        </p>
        <p>
          Warning: API requests can cause the web server to initiate new IRC connections or
          issue IRC commands WITHOUT visibility of the IRC server responses.
          Therefore, it is recommended to use a dedicated IRC test server.
          The irc-hybrid-client was developed using a ngircd IRC server
          available in the Debian 10 apt packages, running in an isolated development environment.
        </p>
        <h3>1 - Postman API calls</h3>
        <p>
          One way to send http requests to the backend is to use
          <a href="https://www.postman.com/downloads/">Postman</a>.
          The irc-hybrid-client github repository includes a Postman collection
          containing example API calls described above.
          This program's API debug collection can be imported into Postman from the cloned repository
          located at
          &quot;/postman/irc-hybrid-client message debug.postman_collection.json&quot;.
        </p>  
        <p>
          Several additional Postman collections are included that allow testing of
          access restrictions of the API routes and testing of websocket authorization.
          Documentation on authorization testing is available in the README.md which is
          located in the directory with the exported collections, as well as comments within the
          Postman collections.
        </p>
        <h4>1A - Configuration of irc-hybrid-client for testing</h4>
        <ul>
          <li>Suggest delete any postman cookies before running tests.</li>
          <li>Assign a temporary user/password in the web server for testing.</li>
          <li>In Postman, create a environment with the variables listed below. Set values to the temporary user/password and server URL.</li>
          <li>Start the irc-hybrid-client web server</li>
        </ul>
        <h4>1B - Postman configuration</h4>
        <p>
          Postman settings: General: Automatically follow redirects: OFF
        </p>
        <h4>1C Postman Environment</h4>
        <p>
          Create a postman environment and create the following variables. 
          A postman environment suitable for testing is included in the repository.
        </p>
        <ul>
          <li>server_URL</li>
          <li>server_user1</li>
          <li>server_password1</li>
          <li>irc_nickname</li>
          <li>irc_channel</li>
          <li>sever_die ("YES" or "NO")</li>
        </ul>
        <h4>1D - Obtaining a postman cookie</h4>
        <p>
          To get a valid cookie, run selections 7.1, 7.2, and 7.3 from the postman collection.
          7.1 Will clear previous cookie.
          7.2 Will request the login form, then extract a login random nonce from the form.
          7.3 Will issue a login authorization POST request containing username and password
          from the local environment and the random nonce from 7.2.
          Steps 7.2 and 7.3 are time critical and must be executed together to avoid
          time expiration of the random nonce.
        </p>

        <h4>1E - List of tests</h4>
        <p>
          Collection: &quot;irc-hybrid-client message debug &quot;
        </p>
        <ul>
          <li>7.1-7.3 Login to web server</li>
          <li>8.1 Selects server index</li>
          <li>8.3 Connect backend to IRC</li>
          <li>8.5 JOIN an IRC channel</li>
          <li>8.7 Send a channel message (PRIVMSG)</li>
          <li>8.8 PART or leave the channel.</li>
          <li>8.10 Remove (prune) the channel data from backend.</li>
          <li>8.12 Retrieve message cache</li>
          <li>8.13 Disconnect backend from IRC</li>
          <li>8.14 Clear the message cache.</li>
          <li>8.16 Terminate (Die) the backend web server.</li>
        </ul>

        <h4>1F Additional documentation</h4>
        <p>
          Additional documentation is available in a README.md file located in the
          github directory where the postman collections are located. The Postman
          collection and individual tests may also include test specific documentation.
        </p>

        <h4>1G - IRC command issuance</h4>
        <p>
          The following screen capture shows an API POST request used to emulate
          transmission of a user text message to an active IRC channel. The body of the POST request contains a
          &quot;message&quot; property containing an RFC 2812 formatted message.
          The IRC message includes the command &quot;PRIVMSG&quot;, followed by the
          first IRC argument (channel name), followed by the second IRC argument (text message content)
          which begins with a colon (:) character, followed by a UTF-8 string terminating
          in an end-of-line character.
        </p>
        <p>
          The postman response shown below has the response body tab selected.
          The contents of the response is limited to a boolean error flag.
          The error condition refers to acceptance
          of the API request by the web server. As the IRC command is passed to the
          IRC server, should an IRC server error occur, the IRC server error
          will appear in the websocket stream, not on the API response.
        </p>
        <img src=images/postman-trace.png width="749" height="438"alt="Postman Example">
        <p>
          Postman is not capable to view the websocket response.
          The expected response should be returned to the web browser as stream data containing
          IRC messages received over the websocket.
          The example below shows the sample websocket message expected from the above Postman request.
          The first line is a RFC 2812 formatted IRC message intended to be parsed by the browser
          in order to add content to the displayed web page.
          The second line starting with &quot;--&gt;&quot; is a verbatim copy of the outgoing
          IRC message sent to the IRC server which is intended to be used for debugging purposes only.
        </p>
<div class="pre-div"><pre>
@time=2021-07-19T14:35:37.000Z :myNick!*@* PRIVMSG #test :This is a test message (irc-hybrid-client)
--> PRIVMSG #test :This is a test message (irc-hybrid-client)
</div>
        <p>
          As a side note, IRC servers do not return outgoing IRC channel text messages back to the IRC client.
          The irc-hybrid-client supports multiple concurrent browsers connected at the same time.
          In order to display outgoing messages on all connected browsers,
          the previous websocket PRIVMSG response was generated by the backend in valid RFC 2812 format,
          so it could be parsed in the browser, equivalent to incoming PRIVSG messages from other users.
        </p>
        <p>
          The following sections include instruction on methods to view these web socket messages.
        </p>

        <h3>2 - Browser Websocket Messages (using IRC client)</h3>
        <p>
          There are two ways to view websocket stream messages.
          Websocket messages can be viewed in raw format within the irc-hybrid-client
          web page. Alternately, a simple html page and javascript file was included
          as a debug tool to monitor the websocket independent of the IRC client web page.
        </p>
        <p>
          To view websocket messages in the IRC client, first open the irc-hybrid-client web page.
          Enter the username and password that were setup for postman tests as described above.
          Next, open the Server window, then select the [More...] button.
        </p>
        <p>
          Selection of the [x]View-Raw checkbox will cause the Server window to display
          raw IRC server messages.
        </p>
        <p>
          Selection of the [x]View-Comms checkbox will add Non-IRC messages to the Server
          window. These include HEARTBEAT, UPDATE, and other informational messages
          as described above. View-Comms requires that View-Raw also be selected.
        </p>

        <img src=images/raw-server-messages.png width="757" height="282"alt="Postman Example">

        <h3>3 - Browser Websocket Messages (custom debug tool)</h3>
        <p>
          The irc-hybrid-client github repository contains a custom web page used to
          test the websocket connection. In order for the session cookies to work properly
          with the websocket, the websocket must exist on the same web server containing
          the browser html page and browser javascript. The custom web page is located
          in the &quot;server/testws&quot; folder. It contains 3 files, one each html, js and css.
          To enable this route and serve these files from the main web server, TEMPORARILY remove comment
          characters from the following code located in the &quot;server/web-server.mjs" file.
          Restart the server after the edit.
        </p>

<div class="pre-div"><pre>
// console.log('******** (debug) /testws route enabled without authorization **********');
// if (nodeEnv === 'development') {
//   const testWs = require('./testws/testws');
//   app.use('/testws', testWs);
// }
</pre></div>

        <p>
          Caution: The /testws route does not require authentication and would be publicly
          visible. Remember to disable the route by replacing the comment characters after testing.
        </p>
        <p>
          It is necessary to obtain a session cookie. Both postman and the web browser each
          requires it's own cookie. The easiest way to do this is to
          open the normal login form at the &quot;/login&quot; route. The login route can be appended to the
          testing web URL, such as &quot;http://localhost:3000/login". The following window should
          open.
        <p>

        <img src=images/web-login.png width="346" height="381"alt="Web login form">

        </p>
          If your login is successful, the normal IRC client page will open.
          This page will not be used. Instead, edit the URL in the browser bar and
          go to the following route: &quot;/testws/test-websocket.html&quot;. If you are using
          localhost, it will look something like this, but possibly a different port number,
          depending on your configuration file.
        </p>

<div class="pre-div"><pre>
http://localhost:3000/testws/test-websocket.html
</pre></div>

        <p>
          The custom web socket debug page should open.
          It will look similar to the following example.
        </p>
        <p>
          In order to connect the web socket, first a special http POST request must be issued
          to schedule the websocket authentication.
          The current expiration time limit is 10 seconds.
          Immediately, the browser must open the websocket, either normal (ws://)
          or with TLS (wss://).
        </p>
        <p>
          To do this, first select the [Schedule Auth] button, then
          immediately select the [Connect Websocket] button.
          If successful, you will see the message: &quot;websocket: open event fired&quot;.
        </p>
        <p>
          Websocket messages appear in the textarea labeled &quot;Messages&quot;
        </p>
        <p>
          Please remember to disable the &quot;/testws&quot; route after testing.
        </p>
        <p>
          For additional information about use of the test websocket page to verifiy
          access restrictions to the web socket, view the README.md file in the
          &quot; server/testws&quot; folder.
        </p>

        <img src=images/websocket-trace.png width="874" height="464"alt="Postman Example">

      </div> <!-- /text-div -->

    </div> <!-- outer-div -->

    <div class="footer-div">
      Repository:
      <a href="https://github.com/cotarr/irc-hybrid-client">
        https://github.com/cotarr/irc-hybrid-client</a>
    </div> <!-- /footer-div -->
	</body>
</html>
