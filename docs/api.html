<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">

		<title>API Examples</title>
    <link rel="stylesheet" href="css/styles.css">
	</head>
	<body>
    <div class="header-div">
      Documentation for
      <a href="https://github.com/cotarr/irc-hybrid-client">irc-hybrid-client</a>
    </div>
    <div class="menu-div-fixed">
      <div class="menu-div">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="installation.html">Installation</a></li>
          <li><a href="login-config.html">Login Config</a></li>
          <li><a href="server-config.html">IRC Config</a></li>
          <li><a href="text-commands.html">Text Commands</a></li>
          <li><a href="faq.html">FAQ</a></li>
          <li><a href="coding.html">Coding Notes</a></li>
          <li><a class="active" href="api.html">API Examples</a></li>
          <li><a href="license.html">License</a></li>
        </ul>
      </div>
    </div> <!-- /menu-div-fixed -->

    <div class="outer-div">
      <div class="text-div">
        <div class="desc-title">
          API Examples
        </div>

        <img src="images/network.png" height="267" width="882" alt="Network Diagram">

        <p>
          Generally, the browser communication is split. Messages from the web server to browser
          are passed over the websocket as RFC 2812 IRC server messages.
          In the reverse direction, no messages are passed from the browser to web server over the websocket.
          All messages from browser to web server are passed over web API using POST and GET requests.
          More specifically, IRC server messages (such as PRIVMSG) are passed over
          the /irc/message route as UTF-8 strings as a POST web API request.
          Information related to the state of the IRC connection and channel membership
          are retrieved as needed by issuing a GET request to the web API.
        </p>

        <p>
          The web browser IRC client operates on IRC messages received from the backend
          NodeJs web server. These are RFC 2812 standard IRC messages.
          Some non-standard (outside RFC 2812) messages are passed over the websocket
          as described below.
        </p>

        <p>
          In most cases, the API requests return a web response showing
          the asynchronous request was either accepted or caused an error.
          The API response body contains an error boolean flag within a JSON object.
        </p>

        <p>
          General state errors, such as &quotIRC Server not connected&quot are returned
          within API response body with status 200 and description of the error as a JSON object.
        </p>

        <p>
          Data validation or parsing errors are returned as status 400 Bad Request.
        </p>

        <p>
          Network connection errors occurring with the IRC server connection between NodeJs backend and IRC server
          are returned in the websocket stream prefixed with the string value &quotwebError: &quot.
        </p>

        <p>
          Errors occurring over IRC network are returned within the websocket stream
          as standard IRC RFC 2812 messages containing 3 digit numeric code and
          descriptive string.
        </p>

        <p>
          Example (generic) API Responses for successful API request:
        </p>
<div class="pre-div"><pre>
{
  "error": false
}
</pre></div>

        <p>
          Example (generic) API Responses for a miscellaneous state error:
        </p>
<div class="pre-div"><pre>
{
  "error": true,
  "message": "IRC server not connected"
}
</pre></div>
        <p>
          Websocket IRC server messages are formed by prepending a timestamp in front of
          of verbatum RFC 2812 IRC server message delimited by end-of-line characters.
          Due to the nature of a text stream buffered I/O, it is possible that
          the one buffer of stream data could contain multiple IRC messages or that a single
          IRC message could be split, half arriving in one buffer and half in the next buffer.
          For reference, RFC 2812 can be viewed at
          <a href="https://datatracker.ietf.org/doc/html/rfc2812">
            https://datatracker.ietf.org/doc/html/rfc2812</a>.
        </p>
<div class="pre-div"><pre>
@time=2021-06-18T21:13:06.949Z :myNickName!*@* PRIVMSG #mychannel :Hi, i'm typing a IRC channel message
</pre></div>

        <p>
          Example Websocket Message (generic) for a network connection error being
          returned asychronously over websocket stream:
        </p>
<div class="pre-div"><pre>
"webError: IRC server timeout while connecting"
</pre></div>

        <p>
          Example Websocket Message (generic) for general info messages over the websocket:
        </p>
<div class="pre-div"><pre>
"webServer: Opening socket to test-server 192.168.1.127:6667"
</pre></div>
        <p>
          A more detail description of web socket use is included near the bottom of this page.
        </p>

        <h1>IRC Client API Routes</h1>

        <h3>POST /irc/server</h3>

        <p>
          The backend NodeJs web server maintains a list of available IRC servers.
          This list is loaded from a configuration file and is not editable from the browser.
          Calls to /irc/server shall include an &quotindex&quot property of type integer
          that is used to select a specific server.
          A value of -1 is used to rotate to the next server in the configuration.
        </p>

        <p>
          When the web server configuration changes to a different server,
          an "UPDATE" command is sent to the browser over the websocket stream.
          Upon receipt of the UPDATE request, the browser should perform a GET request /irc/getircstate.
          The getircstate response contains updated server configuration in JSON format.
          (see getircstate below)
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
  "index": -1
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
    "error": false
}
</pre></div>

<p>Error Response:</p>
<div class="pre-div"><pre>
{
    "error": true,
    "message": "Can not change servers while connected or connecting"
}
</pre></div>

        <h3>POST /irc/connect</h3>

        <p>
          Calls to the connect API are used to request the backend NodeJs web server
          to initiate an IRC server client connection.
          The nickName and realName are required properties of type UTF-8 string.
          The IRC user name (identd alternate user) is not editable from the browser and
          therefore excluded from this schema.
          The initial userMode property is optional.
        </p>

        <p>
          Connection to an IRC server involves several steps, such as opening a TCP socket,
          sending commands to set nickname, and other IRC formation. As the connection is
          established, the irc state object located in the web server is updated.
          Each time the state changes, an "UPDATE" command is sent to the browser
          over the web socket stream.
          Upon receipt of the UPDATE request, the browser should perform a GET request /irc/getircstate
          and update the user interface from information returned in the state object.
          (see getircstate below)
        </p>

<p>POST Request Body</p>
<div class="pre-div"><pre>
{
  "nickName": "myNickName",
  "realName": "John Doe",
  "userMode": ""
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
    "error": false
}
</pre></div>

<p>Error Response:</p>
<div class="pre-div"><pre>
{
    "error": true,
    "message": "Error: already connected to IRC server."
}
</pre></div>

        <h3>POST /irc/message</h3>

        <p>
          Calls to this API are used to send RFC 2812 IRC messages from web browser
          to the NodeJs backend server for re-transmission to the IRC server.
        </p>
        <p>
          The request body should contain a &quotmessage&quot property of type UTF-8 string
          containing the RFC 2812 IRC message.
          Multiple messages are not allowed. The end-of-line characters should not be included.
        </p>

        <p>
          Assuming the IRC command is accepted by the IRC server, the IRC response is
          sent to the browser via the websocket stream as a standard RFC 2812 IRC message.
          These messages are UTF-8 text and delimited by return and end-of-line
          characters 0x10 and 0x13 (&quot&#92;r&#92;n&quot). See RFC 2812 for specification of these messages.
        </p>

        <p>
          Issuing some commands to the IRC server may result in a state change of the IRC client.
          One example would be a command to JOIN an IRC channel.
          Some commands, such as PRIVMSG may not cause a state change.
          Each time the state changes, an "UPDATE" command is sent to the browser
          over the web socket stream.
          Upon receipt of the UPDATE request, the browser should perform a GET request /irc/getircstate
          and update the user interface from information returned in the state object.
          (see getircstate below)
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
  "message": "PRIVMSG #mychannel :Hello World"
}
</pre></div>

<p>Success Response:</p>
<div class="pre-div"><pre>
{
    "error": false
}
</pre></div>

<p>Error Response:</p>
<div class="pre-div"><pre>
{
    "error": true,
    "message": "Can not send server message when IRC server not connected"
}
</pre></div>

<p>Websocket Respose (IRC server PRIVMSG message in stream)</p>
<div class="pre-div"><pre>
@time=2021-06-18T20:09:38.944Z :myNickName!*@* PRIVMSG #test :hello, how are you
</pre></div>

<p>Example Request causing IRC server to issue an error as IRC message
by sending invalid server name with TIME request.</p>
<div class="pre-div"><pre>
{
  "message": "TIME invalid.server.name"
}
</pre></div>

<p>Websocket Error Response (IRC server 402 error message in stream)</p>
<div class="pre-div"><pre>
@time=2021-06-18T20:05:26.538Z :irc.example.com 402 myNickName invalid.server.name :No such server
</pre></div>

        <h3>GET /irc/getircstate</h3>

        <p>
          The actual IRC client is located within the NodeJs backend web server.
          Calls to /irc/getircstate will retrieve a JSON object containing
          all relevant state information for the IRC client connection and IRC channel membership.
        </p>

        <p>
          The web browser should listen for websocket stream message containing a string matching &quotUPDATE&quot.
          When an UPDATE is received as a single line message delimited by 0x10,0x13, (...&#92;r&#92;nUPDATE&#92;r&#92;n...)
          the browser javascript should fetch a GET request to the /irc/getircstate route.
          The browser should then parse the state object for change and update the user interface as needed.
        </p>

        <p>
          This example shows the websocket stream during a conversation between two
          people, while a third new person joins the channel. The IRC server sends a JOIN
          message which is passed through to the browser. In the backend NodeJs web server,
          the new user nickname is added to the list of channel members.
          The UPDATE command is sent to the browser in the websocket stream.
        </p>


<p>Websocket stream showing JOIN to channel and UPDATE command.</p>
<div class="pre-div"><pre>
@time=2021-06-18T21:13:06.949Z :myNickName!*@* PRIVMSG #test :Hello, how are you doing
@time=2021-06-18T21:14:16.322Z :otherName!*@* PRIVMSG #test :I am doing fine, how are you
@time=2021-06-18T21:15:26.412Z :myNickName!*@* PRIVMSG #test :I am fine also, I have to run
@time=2021-06-18T21:16:03.212Z :otherName!*@* PRIVMSG #test :OK, bye for now
@time=2021-06-18T21:21:11.393Z :Mary!newuser@1.2.3.4.example.net JOIN :#mychannel
UPDATE
@time=2021-06-18T21:22:20.433Z :myNickName!*@* PRIVMSG #test :Hello Mary, how are you doing?
</pre></div>

        <p>
          The browser should act on the UPDATE command by obtaining a new state object
          which contains an updated array containing channel member nickanmes.
        </p>

<p>API response to GET /irc/getircstate</p>
<div class="pre-div"><pre>
{
    "ircConnectOn": true,
    "ircConnecting": false,
    "ircConnected": true,
    "ircRegistered": true,
    "ircIsAway": false,
    "ircAutoReconnect": true,
    "ircServerName": "freenode",
    "ircServerHost": "chat.freenode.net",
    "ircServerPort": 7000,
    "ircTLSEnabled": true,
    "ircTLSVerify": true,
    "ircServerIndex": 3,
    "ircServerPrefix": "tildes.freenode.net",
    "ircSockINfo": {
      "encrypted": true,
      "verified": true,
      "protocol": "TLSv1.3"
    }
    "channelList": [],
    "nickName": "myNickName",
    "userName": "myNickName",
    "realName": "myNickName",
    "userMode": "+i",
    "userHost": "~someuser@somehose.example.net",
    "channels": [
      ""#mychannel"
    ],
    "channelStates": [
      {
        "name": "#mychannel",
        "topic": "Welcome to #mychannel cool topic message",
        "names": [
          "@myNickName",
          "@otherName",
          "Mary"
        ],
        "joined": true,
        "kicked": false
      }
    ],
    "progVersion": "0.1.7",
    "progName": "irc-hybrid-client",
    "times": {
        "programRun": "1624047717",
        "ircConnect": "1624047739"
    },
    "count": {
        "ircConnect": 1,
        "ircConnectError": 0
    },
    "websocketCount": 1
}
</pre></div>

        <h3>POST /irc/prune</h3>

        <p>
          This is used to remove a non-joined IRC channel from the active channel list.
          Trying to prune a channel while present in the channel will cause an error.
          The request body shall contain the property &quotchannel&quot of type string
          containing the channel name.
        </p>

<p>POST Request Body</p>
<div class="pre-div"><pre>
{
  "channel": "#test"
}
</pre></div>

        <h3>GET /irc/cache</h3>

        <p>
          The web server maintains a cache of the last 100 IRC server
          messages (lines of text) in RFC 2812 format.
          Performing a GET request to /irc/cache will return a response containing
          and array of up to 100 elements of type string. Each array string element represents
          a previous cached IRC server message.
        </p>

        <p>
          When using this IRC client on an iPhone, there are issues where the websocket
          is disconnected when the screen lock is enabled. Before using this API, the browser
          will clear all previous channel messages, private messages and server messages.
          From the API response, each string in the cache array can be parsed one by one
          as if they had just arrived from the IRC server. This will restore the
          user interface to show messages that may have arrived while the websocket was disconnected.
        </p>

        <p>
          The size of the cache at 100 messages is intended to ride out a screen lock.
          it is not meant to be an offline client. Over time messages will cycle out of the
          cache after 100 messages are received.
        </p>

<p>Example API response:</p>
<div class="pre-div"><pre>
[
  "@time=2021-06-18T21:13:06.949Z :myNickName!*@* PRIVMSG #test :Hello, how are you doing",
  "@time=2021-06-18T21:14:16.949Z :otherName!*@* PRIVMSG #test :I am doing fine, how are you",
  "@time=2021-06-18T21:15:26.949Z :myNickName!*@* PRIVMSG #test :I am fine also, I have to run",
  "@time=2021-06-18T21:16:03.949Z :otherName!*@* PRIVMSG #test :OK, bye for now"
]
</pre></div>

        <h3>POST /irc/erase</h3>

        <p>
          This API is used to delete the contents of the message cache.
          The web server client must be disconnected from IRC to clear the cache.
          A confirmation flag of type boolen is required in an &quoterase&quot property
          in the POST body.
        </p>

<p>POST Request Body:</p>
<div class="pre-div"><pre>
{
  "erase": "YES"
}
</pre></div>


        <h3>POST /irc/disconnect</h3>

        <p>
          This is an emergency function used to forcibly close the socket to the IRC server.
          In routine operation, IRC connections should be closed by sending
          an RFC 2812 &quotQUIT&quot command to the web server for
          re-transmission to the IRC server as a normal IRC command.
          The body of the request should contain an empty JSON object "{}".
        </p>

<p>POST Example body:</p>
<div class="pre-div"><pre>
{
}
</pre></div>

        <h3>POST /terminate</h3>

        This is essentially sending a hard "die" function to forcibly shutdown the NodeJs web server.
        A confirmation flag of type boolen is required in an &quotterminate&quot property
        in the POST body.

<p>POST Example body:</p>
<div class="pre-div"><pre>
{
  "terminate": "YES"
}
</pre></div>


        <div class="desc-title">
          Websocket Interface
        </div>
        <p>
          In a typical IRC client program, such as mirc or hexchat, the client IRC program
          establishes a bi-directional TCP network socket connection between the IRC client and the
          IRC server. The client software sends IRC commands and channel text messages over the
          TCP socket. The IRC server responds asynchronously with RFC 2812 messages over the
          TCP network socket.
        </p>
        <p>
          In the irc-hybrid-client program, the backend web server serves as the IRC client.
          The backend maintains the IRC server TCP socket connection.
          The backend is capable to maintain a valid IRC user connection independant of the web
          browser. Therefore, IRC server messages related to connection status, channel
          membership, and other state is parsed and maintained within the backend server.
        </p>
        <p>
          Although a summary of IRC connection state can be retrieved over the /irc/getircstate API,
          as described above, the ircState json object does not contain text messages from other users.
        </p>
        <p>
          Independant of the TCP socket connection between the backend and the IRC server,
          the web browser opens an independant websocket connection to the backend webserver,
          using ws:// or wss:// protocol standard websocket connections.
          The websocket passes a stream of utf-8 characters.
          Each message is delimited by CR,LF end of line characters.
        </p>
        <p>
          All RFC 2812 messages from the web server are passed through the backend and
          a copy of each message is echoed to the web browser in utf-8 format over the websocket.
          JavaScript in the web browser parses the messages to identify text messages from
          other IRC users. User text messages are then displayed as text content in the appropriate windows.
        </p>
        <p>
          The websocket stream also contain command messages intended to initiate browser actions.
          There are 5 types of command defined in the following table.
          Each message type begins with a specific prefix string as shown in the first table column.
        </p>
        <p>
          Any message not beginning with a command prefix string is considred to be a valid
          RFC 2812 IRC server message. Valid RFC 2812 messages are prefixed with a timestamp
          in IRC_V3 format.
        </p>

        <table class="table-generic">
          <tbody>
            <tr>
              <th>Prefix</th>
              <th>Description</th>
            </tr>
            <tr>
              <td>HEARTBEAT</td>
              <td>
                The web server will send a HEARTBEAT message over the websocket each
                10 seconds. It is the responsibility of the web browser javascript
                to monitor these recurring messages. Absence of the HEARTBEAT messages
                shows the websocket is no longer actively connected to the web server.
              </td>
            </tr>            <tr>
              <td>UPDATE</td>
              <td>
                UPDATE is a command to instruct backend to call /irc/getircstate route in response to a
                change in the ircState object in the backend. For example, when a
                person departs an IRC channel, the departing user's nick name is
                removed from the array of channel membership within the backend ircState object.
                An UPDATE request is sent to the web browser.
                In response the UPDATE message, the browser performs an API call to the
                /irc/getircstate route to obtain a new copy of the ircState object.
                The ircState object is parsed by the browser and the channel membership
                name list is updated in the appropriate channel window.
              </td>
            </tr>
            <tr>
              <td>webServer:</td>
              <td>
                Prefix to indicate an informational message from the backend.
                The webServer messages are primarily intended to show IRC client
                events that are intended for debugging. The webServer messages are
                not intended for display to the IRC user.
              </td>
            </tr>
            <tr>
              <td>webError:</td>
              <td>
                Prefix to indicate an error has been detected by the backend while acting
                as an IRC client program.
                The expectation is that contents of the error are displayed to the IRC user
                as a valid error message within the web page.
              </td>
            </tr>
            <tr>
              <td>--&gt</td>
              <td>
                The prefix &quot--&gt&quot is an indicator to specify copies of outgoing messages that are
                sent from the backend web server to the IRC server.
                Outgoing messages are echoed verbatum to all connected web browsers.
                Some IRC commands containing possible passwords may be filtered.
                Visibility of the exact messages sent to the IRC server can be useful
                when troubleshooting software errors.
                These outgoing messages can be viewed in the IRC client Server window
                by clicking checkboxes for [x]View-Raw and [x]Add-Comms.
                These are outgoing messages and there is assurance the IRC server accepted them
                without error. Therefore, these messages should be considered as
                informational only for debug purposes.
                Messages starting with &quot--&gt&quot should not be parsed by the browser for content.
                As shown in the following example,
                the user +i user mode change should be parsed from the (incoming)
                &quotMODE&quot IRC message, not the (outgoing) &quot--&gt&quot debug message.
              </td>
            </tr>
          </tbody>
        </table>
        <p>
          The following example shows a sample of websocket messages.
        </p>
<div class="pre-div"><pre>
HEARTBEAT
HEARTBEAT
UPDATE
webServer: Opening socket to irc.example.com:6667
webServer: Connected
webServer: Ready
--> NICK myNick
--> USER myUsername 0 * :John Doe
UPDATE
@time=2021-07-19T11:56:30.532Z :irc.example.com 001 myNick :Welcome to the Internet Relay Network myNick!~myUsername@192.168.1.182
@time=2021-07-19T11:56:31.532Z :irc.example.com 002 myNick :Your host is irc.example.com, running version ngircd-25 (x86_64/pc/linux-gnu)
@time=2021-07-19T11:56:31.532Z :irc.example.com 003 myNick :This server has been started Thu Jul 15 2021 at 18:12:20 (UTC)
@time=2021-07-19T11:56:31.532Z :irc.example.com 004 myNick irc.example.com ngircd-25 abBcCFiIoqrRswx abehiIklmMnoOPqQrRstvVz
--> MODE myNick +i
@time=2021-07-19T11:56:32.533Z :myNick!~myUsername@192.168.1.182 MODE myNick :+i
UPDATE
HEARTBEAT
HEARTBEAT
</pre></div>

        <div class="desc-title">
          API Manual Testing
        </div>
        <p>
          Manual testing of the backend web server requires two tools. One to issue
          http GET and POST methods to the web server. These API requests initiate subesequent
          RFC 2812 IRC commands which are sent asynchronously to the IRC server.
          A second tool is required to observe the asynchronous RFC 2812 IRC messages which
          originate in the IRC server and are passed through the web server and
          onward to the web browser using the websocket stream connection.
          The following documentation will explain using Postman to issue API requests.
          Postman is used in combination with a custom websocket monitoring tool included in the repository.
        </p>
        <p>
          Warning: API requests can cause the web server to initiate new IRC connections or
          issue IRC commands WITHOUT visibility of the IRC server responses.
          Therefore, it is recommended to use a dedicated IRC test server.
          The irc-hybrid-client was developed using a ngircd IRC server
          available in the Debian 10 apt packages, running in an isolated development enviornment.
        </p>
        <h3>1 - Postman API calls</h3>
        <p>
          One way to send http requsts to the backend is to use
          <a href="https://www.postman.com/downloads/">Postman</a>.
          The irc-hybrid-client github respository includes a Postman collection
          containing example API calls described above.
          This program's API debug collection can be imported into Postman from the cloned repository
          located at
          &quot/postman/irc-hybrid-client message debug.postman_collection.json&quot.
        </p>
        <p>
          Two additoinal Postman collections are included that allow testing of
          access restrictions of the API routes and websocket that require authorization.
          Documentation on authorization testing is available in the README.md which is
          located in the directory with the exported collections, as well as comments within the
          Postman collections.
        </p>
        <h4>1A - Configuration of irc-hybrid-client for testing</h4>
        <ul>
          <li>Suggest delete any postman cookies before running tests.</li>
          <li>Assign a temporary user/password in the web server for testing.</li>
          <li>In Postman, create a environment with the variables listed below. Set values to the temporary user/password and server URL.</li>
          <li>Start the irc-hybrid-client web server</li>
        </ul>
        <h4>1B - Postman configuration</h4>
        <p>
          Postman settings: General: Automatically follow redirects: OFF
        </p>
        <h4>1C Postman Enviornment</h4>
        <p>
          Create a postman enviornment and create the following variables.
        </p>
        <ul>
          <li>server_URL</li>
          <li>server_user1</li>
          <li>server_password1</li>
          <li>irc_nickname</li>
          <li>irc_channel</li>
          <li>sever_die ("YES" or "NO")</li>
        </ul>
        <h4>1D - Obtaining a postman cookie</h4>
        <p>
          To get a valid cookie, run selections 7.1, 7.2, and 7.3 from the postman collection.
          7.1 Will clear previous cookie.
          7.2 Will request the login form, then extract a login random nonce from the form.
          7.3 Will issue a login authorization POST request containing username and password
          from the local environment and the random nonce from 7.2.
          Steps 7.2 and 7.3 are time critical and must be executed together to avoid
          time expiration of the random nonce.
        </p>

        <h4>1E - List of tests</h4>
        <p>
          Collection: &quotirc-hybrid-client message debug &quot
        </p>
        <ul>
          <li>7.1-7.3 Login to web sevrver</li>
          <li>8.1 Selects server index</li>
          <li>8.3 Connect backend to IRC</li>
          <li>8.5 JOIN an IRC channel</li>
          <li>8.7 Send a channel message (PRIVMSG)</li>
          <li>8.8 PART or leave the channel.</li>
          <li>8.10 Remove (prune) the channel data from backend.</li>
          <li>8.12 Retrieve message cache</li>
          <li>8.13 Disconnect backend from IRC</li>
          <li>8.14 Clear the message cache.</li>
          <li>8.16 Terminate (Die) the backend web server.</li>
        </ul>

        <h4>1F Additional documentation</h4>
        <p>
          Additional documentation is available in a README.md file located in the
          github directory where the postman collections are located. The Postman
          collection and individual tests may also include test specific documentation.
        </p>

        <h4>1G - IRC command issuanace</h4>
        <p>
          The following screen capture shows an API POST request used to emulate
          transmission of a user text message to an active IRC channel. The body of the POST request contains a
          &quotmessage&quot property containing an RFC 2812 formatted message.
          The IRC message includes the command &quotPRIVMSG&quot, followed by the
          first IRC argument (channel name), followed by the second IRC argument (text message content)
          which begins with a colon (:) character, followed by a UTF-8 string terminating
          in an end-of-line character.
        </p>
        <p>
          The postman response shown below has the response body tab selected.
          The contents of the response is limited to a boolean error flag.
          The error condition refers to acceptance
          of the API request by the web server. As the IRC command is passed to the
          IRC server, should an IRC server error occur, the IRC server error
          will appear in the websocket stream, not on the API response.
        </p>
        <img src=images/postman-trace.png width="749" height="438"alt="Postman Example">
        <p>
          Postman is not capable to view the websocket response.
          The expected response should be returned to the web browser as stream data containing
          IRC messages received over the websocket.
          The example below shows the sample websocket message expected from the above Postman request.
          The first line is a RFC 2812 formatted IRC message intended to be parsed by the browser
          in order to add content to the displayed web page.
          The second line starting with &quot--&gt&quot is a verbatum copy of the outgoing
          IRC message sent to the IRC server which is intended to be used for debugging purposes only.
        </p>
<div class="pre-div"><pre>
@time=2021-07-19T14:35:37.000Z :myNick!*@* PRIVMSG #test :This is a test message (irc-hybrid-client)
--> PRIVMSG #test :This is a test message (irc-hybrid-client)
</div>
        <p>
          As a side note, IRC servers do not return outgoing IRC channel text messages back to the IRC client.
          The irc-hybrid-client supports multiple concurrent browsers connected at the same time.
          In order to display outgoing messages on all connected browsers,
          the previous websocket PRIVMSG response was generated by the backend in valid RFC 2812 format,
          so it could be parsed in the browser, equivalent to incoming PRIVSG messages from other users.
        </p>
        <p>
          The following sections include instruction on methods to view these web socket messages.
        </p>

        <h3>2 - Browser Websocket Messages (using IRC client)</h3>
        <p>
          There are two ways to view websocket stream messages.
          Websocket messages can be viewed in raw format within the irc-hybrid-client
          web page. Alternately, a simple html page and javascript file was included
          as a debug tool to monitor the websocket independant of the IRC client web page.
        </p>
        <p>
          To view websocket messages in the IRC client, first open the irc-hybrid-client web page.
          Enter the username and password that were setup for postman tests as decribed above.
          Next, open the Server window, then select the [More...] button.
        </p>
        <p>
          Selection of the [x]View-Raw checkbox will cause the Server window to display
          raw IRC server messages.
        </p>
        <p>
          Selection of the [x]View-Comms checkbox will add Non-IRC messages to the Server
          window. These include HEARTBEAT, UPDATE, and other informational messages
          as described above. View-Comms requres that View-Raw also be selected.
        </p>

        <img src=images/raw-server-messages.png width="757" height="282"alt="Postman Example">

        <h3>3 - Browser Websocket Messages (custom debug tool)</h3>
        <p>
          The irc-hybrid-client github repository contains a custom web page used to
          test the websocket connection. In order for the session cookies to work properly
          with the websocket, the websocket must exist on the same web server containing
          the browser html page and browser javascript. The custom web page is located
          in the &quotserver/testws&quot folder. It contains 3 files, one each html, js and css.
          To enable this route and serve these files from the main web server, TEMPORARILY remove comment
          characters from the following code located in the &quotserver/web-server.js" file.
          Restart the server after the edit.
        </p>

<div class="pre-div"><pre>
// console.log('******** (debug) /testws route enabled without authorization **********');
// if (nodeEnv === 'development') {
//   const testWs = require('./testws/testws');
//   app.use('/testws', testWs);
// }
</pre></div>

        <p>
          Caution: The /testws route does not require authentication and would be publicly
          visible. Remember to disable the route by replacing the comment characters after testing.
        </p>
        <p>
          It is necessary to obtain a session cookie. Both postman and the web browser each
          requires it's own cookie. The easiest way to do this is to
          open the normal login form at the &quot/login&quot route. The login route can be appended to the
          testing web URL, such as &quothttp://localhost:3000/login". The following window should
          open.
        <p>

        <img src=images/web-login.png width="346" height="381"alt="Web login form">

        </p>
          If your login is successful, the normal IRC client page will open.
          This page will not be used. Instead, edit the URL in the browser bar and
          go to the following route: &quot/testws/test-websocket.html&quot. If you are using
          localhost, it will look something like this, but possibly a different port number,
          depending on your configuration file.
        </p>

<div class="pre-div"><pre>
http://localhost:3000/testws/test-websocket.html
</pre></div>

        <p>
          The custom web socket debug page should open.
          It will look similar to the following example.
        </p>
        <p>
          In order to connect the web socket, first a special http POST request must be issued
          to schedule the websocket authentication.
          The current expiration time limit is 10 seconds.
          Immediately, the browser must open the websocket, either normal (ws://)
          or with TLS (wss://).
        </p>
        <p>
          To do this, first select the [Sechedule Auth] button, then
          immediately select the [Connect Websocket] button.
          If successful, you will see the message: &quotwebsocket: open event fired&quot.
        </p>
        <p>
          Websocket messages appear in the textarea labeled &quotMessages&quot
        </p>
        <p>
          Please remember to disable the &quot/testws&quot route after testing.
        </p>
        <p>
          For additional information about use of the test websocket page to verifiy
          access restrictions to the web socket, view the README.md file in the
          &quot server/testws&quot folder.
        </p>

        <img src=images/websocket-trace.png width="874" height="464"alt="Postman Example">

      </div> <!-- /text-div -->

    </div> <!-- outer-div -->

    <div class="footer-div">
      Repository:
      <a href="https://github.com/cotarr/irc-hybrid-client">
        https://github.com/cotarr/irc-hybrid-client</a>
    </div> <!-- /footer-div -->
	</body>
</html>
